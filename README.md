# Code Intelligence Assistant (CIA)

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π Self-Hosted Code Intelligence Assistant (CIA) ‚Äî AI-—Å–∏—Å—Ç–µ–º—É, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ, –∏—Å–ø–æ–ª—å–∑—É—è RAG –∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) fine-tuned small LLM.

## –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–æ–µ–∫—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ Python. –°–æ–∑–¥–∞–π—Ç–µ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –µ–≥–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏:

```bash
python3 -m venv .venv
source .venv/bin/activate
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `pip-tools` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –∏ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

```bash
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º pip-tools, –µ—Å–ª–∏ –µ–≥–æ –µ—â–µ –Ω–µ—Ç
pip install pip-tools

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤ —Ç–æ—á–Ω–æ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å requirements.txt
pip-sync requirements.txt

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—à –ø—Ä–æ–µ–∫—Ç –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
pip install -e .
```

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:
1. –î–æ–±–∞–≤—å—Ç–µ –∏–º—è –ø–∞–∫–µ—Ç–∞ –≤ `requirements.in`.
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `pip-compile --upgrade` –¥–ª—è –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ `requirements.txt`.
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `pip-sync` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∞—à–µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è.


### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DVC

DVC –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–∫–æ–¥–æ–≤—ã—Ö –±–∞–∑). –í–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —É–¥–∞–ª–µ–Ω–Ω–æ–º—É —Ö—Ä–∞–Ω–∏–ª–∏—â—É S3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.dvc/config.local` –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ –Ω–µ–≥–æ —Å–≤–æ–∏ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:

```bash
dvc remote modify --local s3-remote access_key_id YOUR_ACCESS_KEY_ID
dvc remote modify --local s3-remote secret_access_key YOUR_SECRET_ACCESS_KEY
```

–ó–∞–º–µ–Ω–∏—Ç–µ `YOUR_ACCESS_KEY_ID` –∏ `YOUR_SECRET_ACCESS_KEY` –≤–∞—à–∏–º–∏ —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏.

### 4. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ü–æ—Å–ª–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DVC, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (–∫–æ–¥–æ–≤—ã—Ö –±–∞–∑) –∏–∑ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:

```bash
dvc pull
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏ –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:

```
/codesense/
‚îú‚îÄ‚îÄ codesense.yaml           # - –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ data/                      # - –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º DVC
‚îÇ   ‚îú‚îÄ‚îÄ raw/                   #   - –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏)
‚îÇ   ‚îî‚îÄ‚îÄ training/              #   - –î–∞—Ç–∞—Å–µ—Ç—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ infra/                     # - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (IaC)
‚îú‚îÄ‚îÄ scripts/                   # - –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ, –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ repositories-converge.py
‚îú‚îÄ‚îÄ src/                       # - –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º–æ–≥–æ –ø–∞–∫–µ—Ç–∞ "codesense"
‚îÇ   ‚îî‚îÄ‚îÄ codesense/
‚îÇ       ‚îú‚îÄ‚îÄ app/                 #   - FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (RAG-—Å–µ—Ä–≤–∏—Å)
‚îÇ       ‚îú‚îÄ‚îÄ pipelines/           #   - –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –ø–∞–π–ø–ª–∞–π–Ω–æ–≤ –∏ –∏—Ö KFP-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ indexing/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ run.py       #   - "–î–≤–∏–∂–æ–∫" –ø–∞–π–ø–ª–∞–π–Ω–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ component.py #   - –û–ø–∏—Å–∞–Ω–∏–µ KFP-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ Python SDK
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ finetuning/
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ run.py       #   - "–î–≤–∏–∂–æ–∫" –ø–∞–π–ø–ª–∞–π–Ω–∞ –æ–±—É—á–µ–Ω–∏—è
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ component.py #   - –û–ø–∏—Å–∞–Ω–∏–µ KFP-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ Python SDK
‚îÇ       ‚îú‚îÄ‚îÄ processing/          #   - –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–ø–∞—Ä—Å–µ—Ä—ã, —á–∞–Ω–∫–µ—Ä—ã, vector_store)
‚îÇ       ‚îú‚îÄ‚îÄ ml/                  #   - –õ–æ–≥–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π (training loops)
‚îÇ       ‚îî‚îÄ‚îÄ utils/               #   - –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ .gemini/                   # - –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –º–∞—Å—Ç–µ—Ä-–ø–ª–∞–Ω –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–±–æ—Ä–æ–º –¥–∞–Ω–Ω—ã—Ö

–ù–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö (–∫–æ–¥–æ–≤—ã–µ –±–∞–∑—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `codesense.yaml`.

–î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–æ–≤—ã—Ö –±–∞–∑ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç `repositories-converge.py`. –û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∏–≤–∞–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ `codesense.yaml`, –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `data/raw`, –ø–æ—Å–ª–µ —á–µ–≥–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –∏—Ö –≤ DVC –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤ —É–¥–∞–ª–µ–Ω–Ω–æ–µ S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.

### –ó–∞–ø—É—Å–∫

–î–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```bash
python scripts/repositories-converge.py
```

## üöÄ –ó–∞–ø—É—Å–∫ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∫–æ–¥–∞ –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –µ–≥–æ –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö Qdrant –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç `run.py` –≤ –º–æ–¥—É–ª–µ `codesense.pipelines.indexing`.

### –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞

```bash
# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ, –µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–¥–µ–ª–∞–ª–∏ —ç—Ç–æ–≥–æ
# source .venv/bin/activate

python -m codesense.pipelines.indexing.run --collection-name "–∏–º—è-–≤–∞—à–µ–π-–∫–æ–ª–ª–µ–∫—Ü–∏–∏"
```

### ‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã (—Ñ–ª–∞–≥–∏)

–°–∫—Ä–∏–ø—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏:

*   `--collection-name` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): –ò–º—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≤ Qdrant, –≤ –∫–æ—Ç–æ—Ä—É—é –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∏.
    *   *–ü—Ä–∏–º–µ—Ä:* `--collection-name "codesense-dev"`

*   `--batch-size` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `64`): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ Qdrant –∑–∞ –æ–¥–∏–Ω —Ä–∞–∑.
    *   *–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:* –£–º–µ–Ω—å—à–∏—Ç–µ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ `8` –∏–ª–∏ `4`), –µ—Å–ª–∏ –≤—ã —Å—Ç–∞–ª–∫–∏–≤–∞–µ—Ç–µ—Å—å —Å –æ—à–∏–±–∫–∞–º–∏ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –≤–∏–¥–µ–æ–ø–∞–º—è—Ç–∏ (CUDA out of memory) –Ω–∞ GPU.

*   `--debug` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π): –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–∞–π–ø–ª–∞–π–Ω –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏. –í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–µ–±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö (–ø–µ—Ä–≤—ã–µ 512 —á–∞–Ω–∫–æ–≤), —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤—Å–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞.
    *   *–ü—Ä–∏–º–µ—Ä:* `python -m codesense.pipelines.indexing.run --collection-name "test" --debug`
    *   *–ü—Ä–∏–º–µ—Ä:* `python -m codesense.pipelines.indexing.run --collection-name "codesense-dev" --batch-size 2 --debug`
