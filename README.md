# Code Intelligence Assistant (CIA)

Этот проект представляет собой Self-Hosted Code Intelligence Assistant (CIA) — AI-систему, которая отвечает на вопросы по внутренней кодовой базе, используя RAG и (опционально) fine-tuned small LLM.

## Начало работы

### 1. Настройка виртуального окружения

Для изоляции зависимостей проекта используется виртуальное окружение Python. Создайте и активируйте его следующими командами:

```bash
python3 -m venv .venv
source .venv/bin/activate
```

### 2. Установка зависимостей

Установите все необходимые пакеты, перечисленные в `requirements.txt`, а также сам проект в режиме редактирования:

```bash
pip install -r requirements.txt
pip install -e .
```

### 3. Настройка DVC

DVC используется для версионирования данных (кодовых баз). Вам необходимо настроить учетные данные для доступа к удаленному хранилищу S3. Создайте файл `.dvc/config.local` и добавьте в него свои учетные данные:

```bash
dvc remote modify --local s3-remote access_key_id YOUR_ACCESS_KEY_ID
dvc remote modify --local s3-remote secret_access_key YOUR_SECRET_ACCESS_KEY
```

Замените `YOUR_ACCESS_KEY_ID` и `YOUR_SECRET_ACCESS_KEY` вашими реальными ключами.

### 4. Загрузка данных

После клонирования репозитория и настройки DVC, выполните следующую команду, чтобы загрузить актуальную версию набора данных (кодовых баз) из удаленного S3 хранилища:

```bash
dvc pull
```

## Структура Проекта

Проект имеет следующую структуру для обеспечения масштабируемости и разделения ответственности:

```
/codesense/
├── codesense.yaml           # - Главный файл конфигурации проекта
├── data/                      # - Все данные под управлением DVC
│   ├── raw/                   #   - Сырые данные (клонированные репозитории)
│   └── training/              #   - Датасеты для обучения
├── infra/                     # - Конфигурация инфраструктуры (IaC)
├── scripts/                   # - Вспомогательные, операционные скрипты
│   └── repositories-converge.py
├── src/                       # - Исходный код устанавливаемого пакета "codesense"
│   └── codesense/
│       ├── app/                 #   - FastAPI приложение (RAG-сервис)
│       ├── pipelines/           #   - Оркестрация пайплайнов и их KFP-компоненты
│       │   ├── indexing/
│       │   │   ├── run.py       #   - "Движок" пайплайна индексации
│       │   │   └── component.py #   - Описание KFP-компонента через Python SDK
│       │   └── finetuning/
│       │       ├── run.py       #   - "Движок" пайплайна обучения
│       │       └── component.py #   - Описание KFP-компонента через Python SDK
│       ├── processing/          #   - Логика обработки данных (парсеры, чанкеры, vector_store)
│       ├── ml/                  #   - Логика обучения моделей (training loops)
│       └── utils/               #   - Общие утилиты
├── .gemini/                   # - Контекст и мастер-план проекта
├── .gitignore
├── requirements.txt
└── README.md
```

## Управление набором данных

Набор данных (кодовые базы для анализа) определяется в файле `codesense.yaml`.

Для загрузки, обновления и версионирования кодовых баз используется скрипт `repositories-converge.py`. Он автоматически скачивает репозитории, указанные в `codesense.yaml`, в директорию `data/raw`, после чего добавляет их в DVC и загружает в удаленное S3 хранилище.

### Запуск

Для синхронизации набора данных выполните команду:

```bash
python scripts/repositories-converge.py
```